<!DOCTYPE html>
<html lang="en" data-theme="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Interactive dashboard for EPL betting odds analysis and team performance tracking">
    <title>EPL Odds & Performance Dashboard</title>

    <!-- Favicon -->
    <link rel="icon" type="image/svg+xml" href="favicon.svg">
    <link rel="alternate icon" href="favicon.svg">
    <link rel="mask-icon" href="favicon.svg" color="#2ecc71">

    <!-- Preload critical data -->
    <link rel="preload" href="data/aggregated/team-performance-history.json" as="fetch" crossorigin>

    <!-- Styles -->
    <link rel="stylesheet" href="css/main.css">

    <!-- D3.js from CDN -->
    <script src="https://d3js.org/d3.v7.min.js"></script>
</head>
<body>
    <!-- Loading overlay -->
    <div id="loading-overlay" class="loading-overlay">
        <div class="spinner"></div>
        <p>Loading dashboard...</p>
    </div>

    <!-- Header -->
    <header class="header">
        <div class="container">
            <div class="header-content">
                <div class="logo">
                    <h1>EPL Odds Dashboard</h1>
                    <p class="subtitle">Performance vs Betting Expectations</p>
                </div>
                <div class="header-controls">
                    <button id="theme-toggle" class="theme-toggle" aria-label="Toggle theme">
                        <span class="theme-icon sun">‚òÄÔ∏è</span>
                        <span class="theme-icon moon">üåô</span>
                    </button>
                </div>
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <main class="main-content">
        <div class="container">
            <!-- Dashboard View (default) -->
            <div id="dashboard-view" class="view">
                <div class="dashboard-layout">
                    <!-- Main content area -->
                    <div class="main-area">
                        <!-- Stats Summary -->
                <section class="stats-summary">
                    <div class="stat-card">
                        <h3>Total Matches</h3>
                        <p class="stat-value" id="stat-matches">-</p>
                    </div>
                    <div class="stat-card">
                        <h3>Teams Tracked</h3>
                        <p class="stat-value" id="stat-teams">-</p>
                    </div>
                    <div class="stat-card">
                        <h3>Correlation Score</h3>
                        <p class="stat-value" id="stat-correlation">-</p>
                        <p class="stat-subtitle">Prediction Accuracy</p>
                    </div>
                    <div class="stat-card">
                        <h3>Upcoming Matches</h3>
                        <p class="stat-value" id="stat-upcoming">-</p>
                    </div>
                </section>

                <!-- Performance Chart Section -->
                <section class="chart-section">
                    <div class="section-header">
                        <h2>Team Performance vs Spreads</h2>
                        <p class="section-description">
                            Net Performance = (Actual Goal Difference) + (Spread).
                            Positive values indicate outperformance against betting expectations.
                            Example: Favored by -1.0 and win by 1 = net performance of 0 (met expectations exactly).
                        </p>
                    </div>
                    <div class="chart-controls">
                        <label>
                            Sort by:
                            <select id="chart-sort">
                                <option value="performance">Performance</option>
                                <option value="alphabetical">Alphabetical</option>
                            </select>
                        </label>
                        <label>
                            Show:
                            <select id="chart-filter">
                                <option value="all">All Matches</option>
                                <option value="last10">Last 10 Matches</option>
                                <option value="last5">Last 5 Matches</option>
                                <option value="season">This Season</option>
                            </select>
                        </label>
                        <label>
                            Location:
                            <select id="chart-location">
                                <option value="all">Home + Away</option>
                                <option value="home">Home Only</option>
                                <option value="away">Away Only</option>
                            </select>
                        </label>
                    </div>
                    <div id="performance-chart" class="chart-container"></div>
                </section>

                <!-- Historical Trends Preview -->
                <section class="chart-section">
                    <div class="section-header">
                        <h2>Historical Trends (Top 5 Teams)</h2>
                        <p class="section-description">
                            Cumulative net performance over time for top performing teams.
                        </p>
                    </div>
                    <div id="historical-trends" class="chart-container"></div>
                </section>
                    </div><!-- End main-area -->

                    <!-- Sidebar -->
                    <aside class="sidebar">
                        <button id="sidebar-toggle" class="sidebar-toggle">
                            <span>Upcoming Matches</span>
                            <span class="toggle-icon">‚ñ≤</span>
                        </button>
                        <div class="sidebar-content">
                            <div class="table-container">
                                <table id="odds-table" class="odds-table">
                                    <thead>
                                        <tr>
                                            <th>Date</th>
                                            <th>Match</th>
                                            <th>Favorite</th>
                                        </tr>
                                    </thead>
                                    <tbody id="odds-table-body">
                                        <!-- Populated by JavaScript -->
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </aside>
                </div><!-- End dashboard-layout -->
            </div><!-- End dashboard-view -->

            <!-- Team Detail View (hidden by default) -->
            <div id="team-detail-view" class="view" style="display: none;">
                <nav class="breadcrumb">
                    <a href="#" id="back-to-dashboard">‚Üê Back to Dashboard</a>
                </nav>

                <div class="team-header">
                    <h1 id="team-name">Team Name</h1>
                    <div class="team-stats">
                        <div class="team-stat">
                            <span class="label">Net Performance</span>
                            <span class="value" id="team-net-perf">0.00</span>
                        </div>
                        <div class="team-stat">
                            <span class="label">Matches</span>
                            <span class="value" id="team-matches">0</span>
                        </div>
                        <div class="team-stat">
                            <span class="label">Win Rate (Moneyline)</span>
                            <span class="value" id="team-win-rate">0%</span>
                        </div>
                        <div class="team-stat">
                            <span class="label">Spread Cover Rate</span>
                            <span class="value" id="team-cover-rate">0%</span>
                        </div>
                    </div>
                </div>

                <section class="chart-section">
                    <h2>Home vs Away Performance</h2>
                    <p class="section-description">
                        Win Rate = % of matches won outright (W/L/D).
                        Spread Cover Rate = % of matches where team beat the betting spread (performed better than expected).
                    </p>
                    <div class="home-away-breakdown">
                        <div class="location-stat">
                            <h3>Home</h3>
                            <div class="location-details">
                                <p><strong>Net Performance:</strong> <span id="home-net-perf">-</span></p>
                                <p><strong>Matches:</strong> <span id="home-matches">-</span></p>
                                <p><strong>Win Rate (Moneyline):</strong> <span id="home-win-rate">-</span></p>
                                <p><strong>Spread Cover Rate:</strong> <span id="home-cover-rate">-</span></p>
                            </div>
                        </div>
                        <div class="location-stat">
                            <h3>Away</h3>
                            <div class="location-details">
                                <p><strong>Net Performance:</strong> <span id="away-net-perf">-</span></p>
                                <p><strong>Matches:</strong> <span id="away-matches">-</span></p>
                                <p><strong>Win Rate (Moneyline):</strong> <span id="away-win-rate">-</span></p>
                                <p><strong>Spread Cover Rate:</strong> <span id="away-cover-rate">-</span></p>
                            </div>
                        </div>
                    </div>
                </section>

                <section class="chart-section">
                    <h2>Performance Distribution</h2>
                    <p class="section-description">
                        Breakdown of match results and spread betting performance.
                    </p>
                    <div class="pie-charts-container">
                        <div class="pie-chart-wrapper">
                            <h3>Match Results</h3>
                            <div id="results-pie-chart" class="chart-container"></div>
                        </div>
                        <div class="pie-chart-wrapper">
                            <h3>Spread Performance</h3>
                            <div id="covers-pie-chart" class="chart-container"></div>
                        </div>
                    </div>
                </section>

                <section class="chart-section">
                    <h2>Performance Trend</h2>
                    <div id="team-trend-chart" class="chart-container"></div>
                </section>

                <section class="table-section">
                    <h2>Match History</h2>
                    <div class="table-container">
                        <table class="match-history-table">
                            <thead>
                                <tr>
                                    <th>Date</th>
                                    <th>Opponent</th>
                                    <th>Location</th>
                                    <th>Score</th>
                                    <th>Result</th>
                                    <th>Expected (Spread)</th>
                                    <th>Actual Margin</th>
                                    <th>Net Performance</th>
                                    <th>Beat Spread?</th>
                                </tr>
                            </thead>
                            <tbody id="match-history-body">
                                <!-- Populated by JavaScript -->
                            </tbody>
                        </table>
                    </div>
                </section>
            </div>
        </div>
    </main>

    <!-- Footer -->
    <footer class="footer">
        <div class="container">
            <p>Data updated: <span id="last-updated">-</span></p>
            <p>
                <a href="api.html">API Info</a> ‚Ä¢
                <a href="https://github.com/adarshs02/pl-odds" target="_blank">GitHub</a>
            </p>
        </div>
    </footer>

    <!-- JavaScript Modules -->
    <script type="module" src="js/app.js"></script>
</body>
</html>
