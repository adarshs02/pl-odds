<!DOCTYPE html>
<html lang="en" data-theme="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Interactive dashboard for EPL betting odds analysis and team performance tracking">
    <title>EPL Odds & Performance Dashboard</title>

    <!-- Preload critical data -->
    <link rel="preload" href="data/aggregated/team-performance-history.json" as="fetch" crossorigin>

    <!-- Styles -->
    <link rel="stylesheet" href="css/main.css">

    <!-- D3.js from CDN -->
    <script src="https://d3js.org/d3.v7.min.js"></script>
</head>
<body>
    <!-- Loading overlay -->
    <div id="loading-overlay" class="loading-overlay">
        <div class="spinner"></div>
        <p>Loading dashboard...</p>
    </div>

    <!-- Header -->
    <header class="header">
        <div class="container">
            <div class="header-content">
                <div class="logo">
                    <h1>EPL Odds Dashboard</h1>
                    <p class="subtitle">Performance vs Betting Expectations</p>
                </div>
                <div class="header-controls">
                    <button id="theme-toggle" class="theme-toggle" aria-label="Toggle theme">
                        <span class="theme-icon sun">‚òÄÔ∏è</span>
                        <span class="theme-icon moon">üåô</span>
                    </button>
                </div>
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <main class="main-content">
        <div class="container">
            <!-- Dashboard View (default) -->
            <div id="dashboard-view" class="view">
                <!-- Stats Summary -->
                <section class="stats-summary">
                    <div class="stat-card">
                        <h3>Total Matches</h3>
                        <p class="stat-value" id="stat-matches">-</p>
                    </div>
                    <div class="stat-card">
                        <h3>Teams Tracked</h3>
                        <p class="stat-value" id="stat-teams">-</p>
                    </div>
                    <div class="stat-card">
                        <h3>Correlation Score</h3>
                        <p class="stat-value" id="stat-correlation">-</p>
                        <p class="stat-subtitle">Prediction Accuracy</p>
                    </div>
                    <div class="stat-card">
                        <h3>Upcoming Matches</h3>
                        <p class="stat-value" id="stat-upcoming">-</p>
                    </div>
                </section>

                <!-- Performance Chart Section -->
                <section class="chart-section">
                    <div class="section-header">
                        <h2>Team Performance vs Spreads</h2>
                        <p class="section-description">
                            Net Performance = (Actual Goal Difference) - (Spread Line).
                            Positive values indicate outperformance against betting expectations.
                        </p>
                    </div>
                    <div class="chart-controls">
                        <label>
                            Sort by:
                            <select id="chart-sort">
                                <option value="performance">Performance</option>
                                <option value="alphabetical">Alphabetical</option>
                            </select>
                        </label>
                    </div>
                    <div id="performance-chart" class="chart-container"></div>
                </section>

                <!-- Odds Comparison Table -->
                <section class="table-section">
                    <div class="section-header">
                        <h2>Upcoming Matches & Odds</h2>
                        <p class="section-description">
                            Latest betting odds for upcoming EPL matches with implied probabilities.
                        </p>
                    </div>
                    <div id="odds-table-container" class="table-container">
                        <table id="odds-table" class="odds-table">
                            <thead>
                                <tr>
                                    <th class="sortable" data-sort="date">Date</th>
                                    <th>Match</th>
                                    <th class="sortable" data-sort="homeOdds">Home Odds</th>
                                    <th>Draw</th>
                                    <th class="sortable" data-sort="awayOdds">Away Odds</th>
                                    <th>Spread</th>
                                    <th>Favorite</th>
                                </tr>
                            </thead>
                            <tbody id="odds-table-body">
                                <!-- Populated by JavaScript -->
                            </tbody>
                        </table>
                    </div>
                </section>

                <!-- Historical Trends Preview -->
                <section class="chart-section">
                    <div class="section-header">
                        <h2>Historical Trends (Top 5 Teams)</h2>
                        <p class="section-description">
                            Cumulative net performance over time for top performing teams.
                        </p>
                    </div>
                    <div id="historical-trends" class="chart-container"></div>
                </section>
            </div>

            <!-- Team Detail View (hidden by default) -->
            <div id="team-detail-view" class="view" style="display: none;">
                <nav class="breadcrumb">
                    <a href="#" id="back-to-dashboard">‚Üê Back to Dashboard</a>
                </nav>

                <div class="team-header">
                    <h1 id="team-name">Team Name</h1>
                    <div class="team-stats">
                        <div class="team-stat">
                            <span class="label">Net Performance</span>
                            <span class="value" id="team-net-perf">0.00</span>
                        </div>
                        <div class="team-stat">
                            <span class="label">Matches</span>
                            <span class="value" id="team-matches">0</span>
                        </div>
                        <div class="team-stat">
                            <span class="label">Win Rate</span>
                            <span class="value" id="team-win-rate">0%</span>
                        </div>
                        <div class="team-stat">
                            <span class="label">Cover Rate</span>
                            <span class="value" id="team-cover-rate">0%</span>
                        </div>
                    </div>
                </div>

                <section class="chart-section">
                    <h2>Performance Trend</h2>
                    <div id="team-trend-chart" class="chart-container"></div>
                </section>

                <section class="table-section">
                    <h2>Match History</h2>
                    <div class="table-container">
                        <table class="match-history-table">
                            <thead>
                                <tr>
                                    <th>Date</th>
                                    <th>Opponent</th>
                                    <th>Location</th>
                                    <th>Score</th>
                                    <th>Result</th>
                                    <th>Expected (Spread)</th>
                                    <th>Actual Margin</th>
                                    <th>Net Performance</th>
                                    <th>Beat Spread?</th>
                                </tr>
                            </thead>
                            <tbody id="match-history-body">
                                <!-- Populated by JavaScript -->
                            </tbody>
                        </table>
                    </div>
                </section>
            </div>
        </div>
    </main>

    <!-- Footer -->
    <footer class="footer">
        <div class="container">
            <p>Data updated: <span id="last-updated">-</span></p>
            <p>
                <a href="https://github.com/adarshs02/pl-odds" target="_blank">View on GitHub</a>
            </p>
        </div>
    </footer>

    <!-- JavaScript Modules -->
    <script type="module" src="js/app.js"></script>
</body>
</html>
