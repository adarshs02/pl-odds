<!DOCTYPE html>
<html lang="en" data-theme="dark">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description"
        content="Interactive dashboard for EPL betting odds analysis and team performance tracking">
    <title>EPL Odds & Performance Dashboard</title>

    <!-- Favicon -->
    <link rel="icon" type="image/svg+xml" href="favicon.svg">
    <link rel="alternate icon" href="favicon.svg">
    <link rel="mask-icon" href="favicon.svg" color="#2ecc71">

    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Barlow:ital,wght@0,400;0,500;0,600;0,700;1,400&family=Big+Shoulders+Display:wght@400;700;800;900&display=swap" rel="stylesheet">

    <!-- Preload critical data -->
    <link rel="preload" href="data/aggregated/team-performance-history.json" as="fetch" crossorigin>

    <!-- Styles -->
    <link rel="stylesheet" href="css/main.css">

    <!-- D3.js from CDN -->
    <script src="https://d3js.org/d3.v7.min.js"></script>
</head>

<body>
    <!-- Loading overlay -->
    <div id="loading-overlay" class="loading-overlay">
        <div class="loading-bar"></div>
        <p>Kick Off...</p>
    </div>

    <!-- Accent bar -->
    <div class="accent-bar"></div>

    <!-- Header -->
    <header class="header" id="site-header">
        <div class="container">
            <div class="header-content">
                <a href="#dashboard" class="logo">
                    <img src="favicon.svg" alt="EPL Odds" class="logo-icon">
                    <div>
                        <h1>EPL Odds</h1>
                        <p class="subtitle">Performance vs Betting Expectations</p>
                    </div>
                </a>
                <div class="header-controls">
                    <button id="theme-toggle" class="theme-toggle" aria-label="Toggle theme">
                        <svg class="theme-icon sun-icon" xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg>
                        <svg class="theme-icon moon-icon" xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"/></svg>
                    </button>
                </div>
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <main class="main-content">
        <div class="container dashboard-layout">
            <!-- Upcoming Matches Sidebar -->
            <aside class="upcoming-sidebar reveal">
                <h3 class="sidebar-title">Upcoming</h3>
                <div class="upcoming-scroll" id="upcoming-matches-strip">
                    <!-- Populated by JavaScript -->
                </div>
            </aside>

            <!-- Dashboard View (default) -->
            <div id="dashboard-view" class="view">
                <!-- Stats Strip -->
                <section class="stats-strip reveal">
                    <div class="stat-item">
                        <span class="stat-label">Matches</span>
                        <span class="stat-value" id="stat-matches">-</span>
                    </div>
                    <div class="stat-divider"></div>
                    <div class="stat-item">
                        <span class="stat-label">Teams</span>
                        <span class="stat-value" id="stat-teams">-</span>
                    </div>
                    <div class="stat-divider"></div>
                    <div class="stat-item">
                        <span class="stat-label">Correlation</span>
                        <span class="stat-value" id="stat-correlation">-</span>
                        <span class="stat-subtitle">Prediction Accuracy</span>
                    </div>
                    <div class="stat-divider"></div>
                    <div class="stat-item">
                        <span class="stat-label">Upcoming</span>
                        <span class="stat-value" id="stat-upcoming">-</span>
                    </div>
                </section>

                <!-- Performance Chart Section -->
                <section class="chart-section reveal reveal-delay-2">
                    <div class="section-header">
                        <h2>Team Performance vs Spreads</h2>
                        <p class="section-description">
                            Net Performance = (Actual Goal Difference) + (Spread).
                            Positive values indicate outperformance against betting expectations.
                        </p>
                    </div>
                    <div class="chart-controls">
                        <label>
                            Sort by:
                            <select id="chart-sort">
                                <option value="performance">Performance</option>
                                <option value="alphabetical">Alphabetical</option>
                            </select>
                        </label>
                        <label>
                            Show:
                            <select id="chart-filter">
                                <option value="all">All Matches</option>
                                <option value="last10">Last 10 Matches</option>
                                <option value="last5">Last 5 Matches</option>
                                <option value="season">This Season</option>
                            </select>
                        </label>
                        <label>
                            Location:
                            <select id="chart-location">
                                <option value="all">Home + Away</option>
                                <option value="home">Home Only</option>
                                <option value="away">Away Only</option>
                            </select>
                        </label>
                        <label>
                            Bookmaker:
                            <select id="chart-bookmaker">
                                <option value="consensus">Consensus (Avg)</option>
                                <!-- Dynamic options populated by JavaScript -->
                            </select>
                        </label>
                    </div>
                    <div id="performance-chart" class="chart-container"></div>
                </section>

                <!-- Historical Trends Preview -->
                <section class="chart-section reveal reveal-delay-3">
                    <div class="section-header">
                        <h2>Historical Trends (Top 5 Teams)</h2>
                        <p class="section-description">
                            Cumulative net performance over time for top performing teams.
                        </p>
                    </div>
                    <div id="historical-trends" class="chart-container"></div>
                </section>
            </div><!-- End dashboard-view -->

            <!-- Team Detail View (hidden by default) -->
            <div id="team-detail-view" class="view" style="display: none;">
                <nav class="breadcrumb">
                    <a href="#" id="back-to-dashboard">Dashboard</a>
                </nav>

                <div class="team-header">
                    <h1 id="team-name">Team Name</h1>
                    <div class="team-stats">
                        <div class="team-stat">
                            <span class="label">Net Performance</span>
                            <span class="value" id="team-net-perf">0.00</span>
                        </div>
                        <div class="stat-divider"></div>
                        <div class="team-stat">
                            <span class="label">Matches</span>
                            <span class="value" id="team-matches">0</span>
                        </div>
                        <div class="stat-divider"></div>
                        <div class="team-stat">
                            <span class="label">Win Rate (Moneyline)</span>
                            <span class="value" id="team-win-rate">0%</span>
                        </div>
                        <div class="stat-divider"></div>
                        <div class="team-stat">
                            <span class="label">Spread Cover Rate</span>
                            <span class="value" id="team-cover-rate">0%</span>
                        </div>
                    </div>
                </div>

                <section class="chart-section">
                    <h2>Home vs Away Performance</h2>
                    <p class="section-description">
                        Win Rate = % of matches won outright (W/L/D).
                        Spread Cover Rate = % of matches where team beat the betting spread.
                    </p>
                    <div class="home-away-breakdown">
                        <div class="location-stat">
                            <h3>Home</h3>
                            <div class="location-details">
                                <p><strong>Net Performance:</strong> <span id="home-net-perf">-</span></p>
                                <p><strong>Matches:</strong> <span id="home-matches">-</span></p>
                                <p><strong>Win Rate (Moneyline):</strong> <span id="home-win-rate">-</span></p>
                                <p><strong>Spread Cover Rate:</strong> <span id="home-cover-rate">-</span></p>
                            </div>
                        </div>
                        <div class="location-divider"></div>
                        <div class="location-stat">
                            <h3>Away</h3>
                            <div class="location-details">
                                <p><strong>Net Performance:</strong> <span id="away-net-perf">-</span></p>
                                <p><strong>Matches:</strong> <span id="away-matches">-</span></p>
                                <p><strong>Win Rate (Moneyline):</strong> <span id="away-win-rate">-</span></p>
                                <p><strong>Spread Cover Rate:</strong> <span id="away-cover-rate">-</span></p>
                            </div>
                        </div>
                    </div>
                </section>

                <!-- Performance by Bookmaker -->
                <section class="chart-section" id="bookmaker-comparison-section">
                    <h2>Performance by Bookmaker</h2>
                    <p class="section-description">
                        How this team performs against different bookmakers' spreads.
                    </p>
                    <div id="bookmaker-comparison-table">
                        <table class="odds-table">
                            <thead>
                                <tr>
                                    <th>Bookmaker</th>
                                    <th>Net Performance</th>
                                    <th>Cover Rate</th>
                                    <th>Matches w/ Data</th>
                                </tr>
                            </thead>
                            <tbody id="bookmaker-comparison-body">
                            </tbody>
                        </table>
                    </div>
                </section>

                <section class="chart-section">
                    <h2>Performance Distribution</h2>
                    <p class="section-description">
                        Breakdown of match results and spread betting performance.
                    </p>
                    <div class="pie-charts-container">
                        <div class="pie-chart-wrapper">
                            <h3>Match Results</h3>
                            <div id="results-pie-chart" class="chart-container"></div>
                        </div>
                        <div class="pie-chart-wrapper">
                            <h3>Spread Performance</h3>
                            <div id="covers-pie-chart" class="chart-container"></div>
                        </div>
                    </div>
                </section>

                <section class="chart-section">
                    <h2>Performance Trend</h2>
                    <div id="team-trend-chart" class="chart-container"></div>
                </section>

                <section class="table-section">
                    <h2>Match History</h2>
                    <div class="table-container">
                        <table class="match-history-table">
                            <thead>
                                <tr>
                                    <th>Date</th>
                                    <th>Opponent</th>
                                    <th>Location</th>
                                    <th>Score</th>
                                    <th>Result</th>
                                    <th>Expected (Spread)</th>
                                    <th>Actual Margin</th>
                                    <th>Net Performance</th>
                                    <th>Beat Spread?</th>
                                </tr>
                            </thead>
                            <tbody id="match-history-body">
                                <!-- Populated by JavaScript -->
                            </tbody>
                        </table>
                    </div>
                </section>
            </div>
        </div>
    </main>

    <!-- Footer -->
    <footer class="footer">
        <div class="container">
            <p>Data updated: <span id="last-updated">-</span></p>
            <p>
                <a href="api.html">API Info</a> <span class="footer-sep">&middot;</span>
                <a href="https://github.com/adarshs02/pl-odds" target="_blank">GitHub</a>
            </p>
        </div>
    </footer>

    <!-- JavaScript Modules -->
    <script type="module" src="js/app.js"></script>
</body>

</html>
